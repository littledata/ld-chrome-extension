(()=>{"use strict";(()=>{chrome.storage.local.get("state",(i=>{null!==i.state&&!1!==i.state||t(),!0===i.state&&(e(),a(),o())}));const t=()=>{chrome.runtime.sendMessage({from:"content",subject:"changeExtensionIcon",mode:!1})},e=()=>{chrome.runtime.sendMessage({from:"content",subject:"changeExtensionIcon",mode:!0})},a=()=>{var t;const e="("+function(){window.addEventListener("load",(()=>{!function(){var t;const e={href:window.location.href||"",Littledata:{hasLittledataLayer:!1,hasTrackingTag:!1,hasGATrackerJS:!1,hasSegmentTrackerJS:!1,hasCarthookTrackerJS:!1,hasLDBundle:!1,version:"",scriptVersion:"",webPropertyID:""},CookieID:"",ClientID:"",CartClientID:"",Scripts:{classic:!1,universal:!1,doubleclick:!1,gtag:!1,gtm:!1}};if(window.LittledataLayer){e.Littledata.hasLittledataLayer=!0,window.LittledataLayer.version&&(e.Littledata.version=window.LittledataLayer.version),window.LittledataLayer.webPropertyID?e.Littledata.webPropertyID=window.LittledataLayer.webPropertyID:window.LittledataLayer.webPropertyId&&(e.Littledata.webPropertyID=window.LittledataLayer.webPropertyId),window.LittledataScriptVersion&&(e.Littledata.scriptVersion=window.LittledataScriptVersion);const a=document.getElementsByTagName("script"),o=/www\.google\-analytics\.com\/ga\.js/,i=/www\.google\-analytics\.com\/analytics\.js/,s=/stats\.g\.doubleclick\.net\/dc\.js/,n=/www\.googletagmanager\.com\/gtag\/js/,r=/www\.googletagmanager\.com\/gtm\.js/,c=/.+\/carthookTracker\.js/,l=/.+\/colibrius-g\.js/,d=/.+\/colibrius-s\.js/,g=/.+\/colibrius\.js/;for(let t=0,w=a.length;t<w;t++)o.test(a[t].src)&&(e.Scripts.classic=!0),i.test(a[t].src)&&(e.Scripts.universal=!0),s.test(a[t].src)&&(e.Scripts.doubleclick=!0),n.test(a[t].src)&&(e.Scripts.gtag=!0),r.test(a[t].src)&&(e.Scripts.gtm=!0),c.test(a[t].src)&&(e.Littledata.hasCarthookTrackerJS=!0),l.test(a[t].src)&&(e.Littledata.hasGATrackerJS=!0),d.test(a[t].src)&&(e.Littledata.hasSegmentTrackerJS=!0),g.test(a[t].src)&&(e.Littledata.hasLDBundle=!0);try{const t=/\/[\/\*]\s*Version\s+(v?\d+\.\d+(?:\.\d+){0,2})/gi,a=/UA\-\d+\-\d+/,o=document.querySelector('[name="littledata-tracking-tag"]');if(o){e.Littledata.hasTrackingTag=!0;const i=o.textContent;if(!i)return;if(""===e.Littledata.version){const a=t.exec(i);a&&a[1]&&(e.Littledata.version=a[1])}if(null==e.Littledata.webPropertyID){const t=a.exec(i);e.Littledata.webPropertyID=t?t[0]:window.ga.getAll()[0].get("trackingId")}}else console.debug("Could not find LD tag")}catch(t){}try{const a=("; "+document.cookie).split("; _ga=");if(2==a.length){const o=null===(t=a.pop())||void 0===t?void 0:t.split(";").shift(),i=null==o?void 0:o.split(".");4==(null==i?void 0:i.length)&&(e.CookieID=i[2]+"."+i[3])}}catch(t){}try{e.ClientID=window.ga.getAll()[0].get("clientId")}catch(t){}const w=t=>{let a;t.attributes&&(a=t.attributes["google-clientID"],a?e.CartClientID=a:(a=t.attributes.clientID,a&&(e.CartClientID=a,console.debug("legacy CCID"))),console.debug("LD extension output:",JSON.stringify(e,null,2)))};fetch("/cart.js").then((async t=>{const e=await t.json();return t.ok?w(e):Promise.reject({status:t.status,cartData:e})})).then((()=>{e.Littledata.hasLittledataLayer&&window.dispatchEvent(new CustomEvent("setLittledataPageData",{detail:e}))})).catch((t=>console.debug("Littlebug fetch error: ",t)))}}()})),window.location.hostname.indexOf("littledata.io")>-1&&window.localStorage.setItem("LD internal","yes")}+")();",a=document.createElement("script");a.textContent=e,document.documentElement.appendChild(a),null===(t=a.parentNode)||void 0===t||t.removeChild(a)},o=()=>{let t=[];chrome.storage.local.get("pageLog",(e=>{e.pageLog&&(t=JSON.parse(e.pageLog))})),window.addEventListener("setLittledataPageData",(e=>{t.push(e.detail),chrome.runtime.sendMessage({from:"content",subject:"savePageLogData",data:JSON.stringify(t)})}))}})()})();